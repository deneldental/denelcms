(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,499905,e=>{"use strict";var s=e.i(95187);let a=(0,s.createServerReference)("70740605ad18f55cb38b1054f3146398a84c647a9d",s.callServer,void 0,s.findSourceMapURL,"sendSMS");e.s(["sendSMS",()=>a])},851440,e=>{"use strict";var s=e.i(843476),a=e.i(271645),t=e.i(970065),l=e.i(167881),n=e.i(23750),r=e.i(10708),i=e.i(184762),d=e.i(531278),c=e.i(107233),o=e.i(37727),m=e.i(846696),h=e.i(23467),x=e.i(499905),u=e.i(62870);function p(){let[e,p]=(0,a.useState)(!1),[j,g]=(0,a.useState)([]),[f,b]=(0,a.useState)("Framada"),[N,y]=(0,a.useState)(""),[S,v]=(0,a.useState)([]),[w,T]=(0,a.useState)("");(0,a.useEffect)(()=>{let e=!0;return(async()=>{let s=await (0,h.getPatients)();e&&s.success&&s.data&&g(s.data)})(),()=>{e=!1}},[]);let C=async()=>{if(0===S.length)return void m.toast.error("Please add at least one recipient");if(!N.trim())return void m.toast.error("Please enter a message");p(!0);let e=S.map(e=>({phone:e.phone,message:e.message||N,patientId:e.patientId})),s=await (0,x.sendSMS)(e,f,"bulk");p(!1),s.success?(m.toast.success(`SMS sent successfully to ${S.length} recipient(s)`),v([]),y("")):m.toast.error(s.error||"Failed to send SMS")};return(0,s.jsx)("div",{className:"space-y-6",children:(0,s.jsxs)(t.Card,{children:[(0,s.jsxs)(t.CardHeader,{children:[(0,s.jsx)(t.CardTitle,{children:"Bulk SMS"}),(0,s.jsx)(t.CardDescription,{children:"Send personalized SMS messages to multiple recipients."})]}),(0,s.jsxs)(t.CardContent,{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(r.Label,{htmlFor:"from",children:"From (Sender Name)"}),(0,s.jsx)(n.Input,{id:"from",value:f,onChange:e=>b(e.target.value),placeholder:"Framada"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(r.Label,{htmlFor:"message",children:"Message Template"}),(0,s.jsx)(i.Textarea,{id:"message",value:N,onChange:e=>{y(e.target.value),v(S.map(s=>({...s,message:e.target.value})))},placeholder:"Enter your message here...",rows:4}),(0,s.jsxs)("p",{className:"text-xs text-muted-foreground",children:[N.length," characters"]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(r.Label,{children:"Add Recipients"}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsxs)(u.Select,{value:w,onValueChange:T,children:[(0,s.jsx)(u.SelectTrigger,{className:"flex-1",children:(0,s.jsx)(u.SelectValue,{placeholder:"Select a patient"})}),(0,s.jsx)(u.SelectContent,{children:j.filter(e=>{let s=e.isChild&&e.guardianPhone?e.guardianPhone:e.phone;return s&&!S.some(e=>e.phone===s)}).map(e=>{let a=e.isChild&&e.guardianPhone?e.guardianPhone:e.phone;return(0,s.jsxs)(u.SelectItem,{value:e.id,children:[e.name," ",a&&`(${a})`]},e.id)})})]}),(0,s.jsxs)(l.Button,{onClick:()=>{if(!w)return void m.toast.error("Please select a patient");let e=j.find(e=>e.id===w);if(!e)return;let s=e.isChild&&e.guardianPhone?e.guardianPhone:e.phone;s?S.some(e=>e.phone===s)?m.toast.error("Patient already added"):(v([...S,{phone:s,message:N,patientId:e.id,patientName:e.name}]),T("")):m.toast.error("Selected patient does not have a phone number")},type:"button",children:[(0,s.jsx)(c.Plus,{className:"h-4 w-4 mr-2"}),"Add"]})]})]}),S.length>0&&(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)(r.Label,{children:["Recipients (",S.length,")"]}),(0,s.jsx)("div",{className:"space-y-2 max-h-[300px] overflow-y-auto border rounded-lg p-4",children:S.map(e=>(0,s.jsxs)("div",{className:"flex gap-2 items-start p-2 border rounded",children:[(0,s.jsxs)("div",{className:"flex-1 space-y-1",children:[(0,s.jsx)("p",{className:"text-sm font-medium",children:e.patientName||e.phone}),(0,s.jsx)(i.Textarea,{value:e.message,onChange:s=>{var a,t;return a=e.phone,t=s.target.value,void v(S.map(e=>e.phone===a?{...e,message:t}:e))},placeholder:"Personalized message (optional)",rows:2,className:"text-xs"})]}),(0,s.jsx)(l.Button,{variant:"ghost",size:"sm",onClick:()=>{var s;return s=e.phone,void v(S.filter(e=>e.phone!==s))},type:"button",children:(0,s.jsx)(o.X,{className:"h-4 w-4"})})]},e.phone))})]}),(0,s.jsxs)(l.Button,{onClick:C,disabled:e||0===S.length,className:"w-full",children:[e&&(0,s.jsx)(d.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Send SMS to ",S.length," ",1===S.length?"Recipient":"Recipients"]})]})]})})}e.s(["BulkSMSTab",()=>p])},514764,e=>{"use strict";var s=e.i(54089);e.s(["Send",()=>s.default])},682470,e=>{"use strict";var s=e.i(843476),a=e.i(271645),t=e.i(970065),l=e.i(167881),n=e.i(23750),r=e.i(10708),i=e.i(184762),d=e.i(531278),c=e.i(514764),o=e.i(846696),m=e.i(95187);let h=(0,m.createServerReference)("00a4eafc19de9bd0da95f86e8c279948c8c5a3018e",m.callServer,void 0,m.findSourceMapURL,"getUpcomingBirthdays");var x=e.i(499905),u=e.i(401851),p=e.i(994179),j=e.i(947627);function g(){let[e,m]=(0,a.useState)(!1),[g,f]=(0,a.useState)(!0),[b,N]=(0,a.useState)([]),[y,S]=(0,a.useState)("Framada"),[v,w]=(0,a.useState)("Happy Birthday {{name}}! Wishing you a wonderful day filled with joy and happiness. - Framada Clinic"),[T,C]=(0,a.useState)(null);(0,a.useEffect)(()=>{let e=!0;return(async()=>{let s=await h();e&&(f(!1),s.success&&s.data?N(s.data):o.toast.error(s.error||"Failed to load upcoming birthdays"))})(),()=>{e=!1}},[]);let M=e=>v.replace(/{{name}}/g,e.patientName).replace(/{{age}}/g,e.age.toString()),I=async e=>{if(!e.phone)return void o.toast.error("Patient does not have a phone number");C(e.patientId),m(!0);let s=M(e),a=await (0,x.sendSMS)([{phone:e.phone,message:s,patientId:e.patientId}],y,"birthday");m(!1),C(null),a.success?(o.toast.success(`Birthday SMS sent to ${e.patientName}`),N(b.filter(s=>s.patientId!==e.patientId))):o.toast.error(a.error||"Failed to send SMS")},H=async()=>{let e=b.filter(e=>e.phone);if(0===e.length)return void o.toast.error("No patients with phone numbers to send SMS");m(!0);let s=e.map(e=>({phone:e.phone,message:M(e),patientId:e.patientId})),a=await (0,x.sendSMS)(s,y,"birthday");m(!1),a.success?(o.toast.success(`Birthday SMS sent to ${s.length} patient(s)`),N([])):o.toast.error(a.error||"Failed to send SMS")};return(0,s.jsx)("div",{className:"space-y-6",children:(0,s.jsxs)(t.Card,{children:[(0,s.jsxs)(t.CardHeader,{children:[(0,s.jsx)(t.CardTitle,{children:"Birthday SMS"}),(0,s.jsx)(t.CardDescription,{children:"Send birthday wishes to patients with upcoming birthdays (next 30 days)."})]}),(0,s.jsxs)(t.CardContent,{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(r.Label,{htmlFor:"from-birthday",children:"From (Sender Name)"}),(0,s.jsx)(n.Input,{id:"from-birthday",value:y,onChange:e=>S(e.target.value),placeholder:"Framada"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(r.Label,{htmlFor:"message-template",children:"Message Template"}),(0,s.jsx)(i.Textarea,{id:"message-template",value:v,onChange:e=>w(e.target.value),placeholder:"Happy Birthday {{name}}! ...",rows:4}),(0,s.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Use ","{{name}}"," for patient name and ","{{age}}"," for age. ",v.length," ","characters."]})]}),g?(0,s.jsxs)("div",{className:"text-center py-8",children:[(0,s.jsx)(d.Loader2,{className:"h-6 w-6 animate-spin mx-auto mb-2"}),(0,s.jsx)("p",{className:"text-muted-foreground",children:"Loading upcoming birthdays..."})]}):0===b.length?(0,s.jsx)("div",{className:"text-center py-8 border rounded-lg",children:(0,s.jsx)("p",{className:"text-muted-foreground",children:"No upcoming birthdays in the next 30 days."})}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("p",{className:"text-sm text-muted-foreground",children:[b.length," upcoming ",1===b.length?"birthday":"birthdays"]}),(0,s.jsxs)(l.Button,{onClick:H,disabled:e||0===b.filter(e=>e.phone).length,size:"sm",children:[e&&(0,s.jsx)(d.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Send All"]})]}),(0,s.jsx)("div",{className:"border rounded-lg",children:(0,s.jsxs)(j.Table,{children:[(0,s.jsx)(j.TableHeader,{children:(0,s.jsxs)(j.TableRow,{children:[(0,s.jsx)(j.TableHead,{children:"Patient"}),(0,s.jsx)(j.TableHead,{children:"Birthday"}),(0,s.jsx)(j.TableHead,{children:"Days Until"}),(0,s.jsx)(j.TableHead,{children:"Age"}),(0,s.jsx)(j.TableHead,{children:"Phone"}),(0,s.jsx)(j.TableHead,{className:"text-right",children:"Action"})]})}),(0,s.jsx)(j.TableBody,{children:b.map(a=>(0,s.jsxs)(j.TableRow,{children:[(0,s.jsx)(j.TableCell,{className:"font-medium",children:a.patientName}),(0,s.jsx)(j.TableCell,{children:(0,u.format)(new Date(a.birthdayDate),"MMM d, yyyy")}),(0,s.jsx)(j.TableCell,{children:(0,s.jsx)(p.Badge,{variant:0===a.daysUntil?"default":"secondary",children:0===a.daysUntil?"Today":`${a.daysUntil} day${1===a.daysUntil?"":"s"}`})}),(0,s.jsxs)(j.TableCell,{children:[a.age," years"]}),(0,s.jsx)(j.TableCell,{children:a.phone||(0,s.jsx)("span",{className:"text-muted-foreground",children:"No phone"})}),(0,s.jsx)(j.TableCell,{className:"text-right",children:(0,s.jsx)(l.Button,{size:"sm",onClick:()=>I(a),disabled:e||!a.phone||T===a.patientId,children:e&&T===a.patientId?(0,s.jsx)(d.Loader2,{className:"h-4 w-4 animate-spin"}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(c.Send,{className:"h-4 w-4 mr-2"}),"Send"]})})})]},a.patientId))})]})})]})]})]})})}e.s(["BirthdaySMSTab",()=>g],682470)},936946,e=>{"use strict";var s=e.i(843476),a=e.i(271645),t=e.i(970065),l=e.i(167881),n=e.i(23750),r=e.i(10708),i=e.i(184762),d=e.i(531278),c=e.i(514764),o=e.i(846696),m=e.i(95187);let h=(0,m.createServerReference)("00a5681203ff07ef45c47d0f45c5c7f286a135d6c6",m.callServer,void 0,m.findSourceMapURL,"getFollowupAppointments");var x=e.i(499905),u=e.i(401851),p=e.i(994179),j=e.i(947627);function g(){let[e,m]=(0,a.useState)(!1),[g,f]=(0,a.useState)(!0),[b,N]=(0,a.useState)([]),[y,S]=(0,a.useState)("Framada"),[v,w]=(0,a.useState)("Hello {{name}}, this is a follow-up from your recent {{type}} appointment on {{date}}. How are you feeling? Please reply if you have any concerns. - Framada Clinic"),[T,C]=(0,a.useState)(null);(0,a.useEffect)(()=>{let e=!0;return(async()=>{let s=await h();e&&(f(!1),s.success&&s.data?N(s.data):o.toast.error(s.error||"Failed to load follow-up appointments"))})(),()=>{e=!1}},[]);let M=e=>v.replace(/{{name}}/g,e.patientName).replace(/{{type}}/g,e.appointmentType).replace(/{{date}}/g,(0,u.format)(new Date(e.appointmentDate),"MMM d, yyyy")),I=async e=>{if(!e.phone)return void o.toast.error("Patient does not have a phone number");C(e.appointmentId),m(!0);let s=M(e),a=await (0,x.sendSMS)([{phone:e.phone,message:s,patientId:e.patientId}],y,"followup");m(!1),C(null),a.success?(o.toast.success(`Follow-up SMS sent to ${e.patientName}`),N(b.filter(s=>s.appointmentId!==e.appointmentId))):o.toast.error(a.error||"Failed to send SMS")},H=async()=>{let e=b.filter(e=>e.phone);if(0===e.length)return void o.toast.error("No appointments with phone numbers to send SMS");m(!0);let s=e.map(e=>({phone:e.phone,message:M(e),patientId:e.patientId})),a=await (0,x.sendSMS)(s,y,"followup");m(!1),a.success?(o.toast.success(`Follow-up SMS sent to ${s.length} patient(s)`),N([])):o.toast.error(a.error||"Failed to send SMS")};return(0,s.jsx)("div",{className:"space-y-6",children:(0,s.jsxs)(t.Card,{children:[(0,s.jsxs)(t.CardHeader,{children:[(0,s.jsx)(t.CardTitle,{children:"Follow-up SMS"}),(0,s.jsx)(t.CardDescription,{children:"Send follow-up messages to patients who completed appointments in the last 7 days."})]}),(0,s.jsxs)(t.CardContent,{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(r.Label,{htmlFor:"from-followup",children:"From (Sender Name)"}),(0,s.jsx)(n.Input,{id:"from-followup",value:y,onChange:e=>S(e.target.value),placeholder:"Framada"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(r.Label,{htmlFor:"message-template-followup",children:"Message Template"}),(0,s.jsx)(i.Textarea,{id:"message-template-followup",value:v,onChange:e=>w(e.target.value),placeholder:"Hello {{name}}, this is a follow-up...",rows:4}),(0,s.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Use ","{{name}}"," for patient name, ","{{type}}"," for appointment type, and ","{{date}}"," ","for appointment date. ",v.length," characters."]})]}),g?(0,s.jsxs)("div",{className:"text-center py-8",children:[(0,s.jsx)(d.Loader2,{className:"h-6 w-6 animate-spin mx-auto mb-2"}),(0,s.jsx)("p",{className:"text-muted-foreground",children:"Loading follow-up appointments..."})]}):0===b.length?(0,s.jsx)("div",{className:"text-center py-8 border rounded-lg",children:(0,s.jsx)("p",{className:"text-muted-foreground",children:"No completed appointments in the last 7 days."})}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("p",{className:"text-sm text-muted-foreground",children:[b.length," ",1===b.length?"appointment":"appointments"," ","for follow-up"]}),(0,s.jsxs)(l.Button,{onClick:H,disabled:e||0===b.filter(e=>e.phone).length,size:"sm",children:[e&&(0,s.jsx)(d.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Send All"]})]}),(0,s.jsx)("div",{className:"border rounded-lg",children:(0,s.jsxs)(j.Table,{children:[(0,s.jsx)(j.TableHeader,{children:(0,s.jsxs)(j.TableRow,{children:[(0,s.jsx)(j.TableHead,{children:"Patient"}),(0,s.jsx)(j.TableHead,{children:"Appointment Date"}),(0,s.jsx)(j.TableHead,{children:"Type"}),(0,s.jsx)(j.TableHead,{children:"Phone"}),(0,s.jsx)(j.TableHead,{className:"text-right",children:"Action"})]})}),(0,s.jsx)(j.TableBody,{children:b.map(a=>(0,s.jsxs)(j.TableRow,{children:[(0,s.jsx)(j.TableCell,{className:"font-medium",children:a.patientName}),(0,s.jsx)(j.TableCell,{children:(0,u.format)(new Date(a.appointmentDate),"MMM d, yyyy 'at' h:mm a")}),(0,s.jsx)(j.TableCell,{children:(0,s.jsx)(p.Badge,{variant:"outline",className:"capitalize",children:a.appointmentType})}),(0,s.jsx)(j.TableCell,{children:a.phone||(0,s.jsx)("span",{className:"text-muted-foreground",children:"No phone"})}),(0,s.jsx)(j.TableCell,{className:"text-right",children:(0,s.jsx)(l.Button,{size:"sm",onClick:()=>I(a),disabled:e||!a.phone||T===a.appointmentId,children:e&&T===a.appointmentId?(0,s.jsx)(d.Loader2,{className:"h-4 w-4 animate-spin"}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(c.Send,{className:"h-4 w-4 mr-2"}),"Send"]})})})]},a.appointmentId))})]})})]})]})]})})}e.s(["FollowupSMSTab",()=>g],936946)},16715,e=>{"use strict";var s=e.i(563906);e.s(["RefreshCw",()=>s.default])},110649,e=>{"use strict";var s=e.i(843476),a=e.i(271645),t=e.i(970065),l=e.i(167881),n=e.i(23750),r=e.i(10708),i=e.i(531278),d=e.i(555436),c=e.i(16715),o=e.i(846696),m=e.i(95187);let h=(0,m.createServerReference)("604d05c91c395d4e977b0e4491300e99a51e9781e0",m.callServer,void 0,m.findSourceMapURL,"getSMSStatus"),x=(0,m.createServerReference)("004632375a5520f06be99da71d158e50f534a27afb",m.callServer,void 0,m.findSourceMapURL,"getSentSMSMessages"),u=(0,m.createServerReference)("008f065dff5be5450a9e2b4a824d0d4fd9a70cbc17",m.callServer,void 0,m.findSourceMapURL,"getPrepaidBalance");var p=e.i(994179),j=e.i(625959),g=e.i(401851),f=e.i(947627);function b(){let[e,m]=(0,a.useState)(!1),[b,N]=(0,a.useState)(!0),[y,S]=(0,a.useState)(!1),[v,w]=(0,a.useState)([]),[T,C]=(0,a.useState)(""),[M,I]=(0,a.useState)(!1),[H,R]=(0,a.useState)(null),[F,B]=(0,a.useState)(null),[L,D]=(0,a.useState)(null),[P,A]=(0,a.useState)(null),[k,U]=(0,a.useState)(null);(0,a.useEffect)(()=>{let e=!0;return(async()=>{N(!0);let s=await x();S(!0),A(null),U(null);let a=await u();e&&(N(!1),s.success&&s.data&&w(s.data),S(!1),a.success&&a.data?D(a.data):(A(a.error||"Failed to load prepaid balance"),U(a.details||null)))})(),()=>{e=!1}},[]);let E=async()=>{S(!0),A(null),U(null);let e=await u();if(S(!1),e.success&&e.data)D(e.data),A(null),U(null);else{let s=e.error||"Failed to load prepaid balance";A(s),U(e.details||null),D(null),console.warn("Failed to load prepaid balance:",{error:s,details:e.details,status:e.status})}},z=async()=>{N(!0);let e=await x();N(!1),e.success&&e.data?w(e.data):o.toast.error(e.error||"Failed to load sent SMS messages")},$=async e=>{let s=e?e.batchId||e.messageId||"":T.trim();if(!s)return void o.toast.error("Please enter a Message ID or Batch ID, or select a message");let a=e?!!e.batchId:M;B(e?.id||null),m(!0);let t=await h(s,a);m(!1),B(null),t.success&&t.data?(R(t.data),o.toast.success("Status retrieved successfully"),z()):(o.toast.error(t.error||"Failed to retrieve status"),R(null))},_=e=>e&&({sent:"default",delivered:"default",failed:"destructive",pending:"secondary",queued:"secondary"})[e.toLowerCase()]||"outline";return(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)(t.Card,{children:[(0,s.jsx)(t.CardHeader,{children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(t.CardTitle,{children:"Prepaid Balance"}),(0,s.jsx)(t.CardDescription,{children:"Current SMS prepaid balance from Hubtel."})]}),(0,s.jsxs)(l.Button,{onClick:E,variant:"outline",size:"sm",disabled:y,children:[(0,s.jsx)(c.RefreshCw,{className:`h-4 w-4 mr-2 ${y?"animate-spin":""}`}),"Refresh"]})]})}),(0,s.jsx)(t.CardContent,{children:y?(0,s.jsxs)("div",{className:"text-center py-8",children:[(0,s.jsx)(i.Loader2,{className:"h-6 w-6 animate-spin mx-auto mb-2"}),(0,s.jsx)("p",{className:"text-muted-foreground",children:"Loading balance..."})]}):P?(0,s.jsxs)("div",{className:"text-center py-8 border rounded-lg border-destructive/50 bg-destructive/5",children:[(0,s.jsx)("p",{className:"text-destructive font-medium mb-2",children:"Unable to load balance"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground mb-4",children:P}),P.includes("not configured")&&(0,s.jsxs)("div",{className:"mt-4 text-xs text-muted-foreground space-y-1",children:[(0,s.jsxs)("p",{children:["Please ensure the following environment variables are set in"," ",(0,s.jsx)("code",{className:"bg-muted px-1 py-0.5 rounded",children:".env.local"}),":"]}),(0,s.jsxs)("ul",{className:"list-disc list-inside space-y-1 mt-2",children:[(0,s.jsx)("li",{children:(0,s.jsx)("code",{children:"HUBTEL_CLIENT_ID"})}),(0,s.jsx)("li",{children:(0,s.jsx)("code",{children:"HUBTEL_CLIENT_SECRET"})}),(0,s.jsx)("li",{children:(0,s.jsx)("code",{children:"PREPAID_DEPOSIT_ID"})})]})]}),(P.includes("404")||P.includes("not found"))&&(0,s.jsxs)("div",{className:"mt-4 text-xs text-muted-foreground",children:[(0,s.jsx)("p",{children:"Possible issues:"}),(0,s.jsxs)("ul",{className:"list-disc list-inside space-y-1 mt-2",children:[(0,s.jsx)("li",{children:"The PREPAID_DEPOSIT_ID may be incorrect"}),(0,s.jsx)("li",{children:"The prepaid account may not exist in your Hubtel account"}),(0,s.jsxs)("li",{children:["Check your Hubtel dashboard at"," ",(0,s.jsx)("code",{className:"bg-muted px-1 py-0.5 rounded",children:"https://app-site.hubtel.com/money/accounts"})]})]})]}),(P.includes("401")||P.includes("Authentication"))&&(0,s.jsx)("div",{className:"mt-4 text-xs text-muted-foreground",children:(0,s.jsxs)("p",{children:["Please verify your Hubtel API credentials are correct in"," ",(0,s.jsx)("code",{className:"bg-muted px-1 py-0.5 rounded",children:".env.local"})]})}),(P.includes("Network")||P.includes("connect"))&&(0,s.jsxs)("div",{className:"mt-4 text-xs text-muted-foreground",children:[(0,s.jsx)("p",{children:"Network connectivity issue. Please check:"}),(0,s.jsxs)("ul",{className:"list-disc list-inside space-y-1 mt-2",children:[(0,s.jsx)("li",{children:"Your internet connection"}),(0,s.jsx)("li",{children:"Hubtel API service status"}),(0,s.jsx)("li",{children:"Firewall/proxy settings"})]})]}),k&&(0,s.jsxs)("details",{className:"mt-4 text-left",children:[(0,s.jsx)("summary",{className:"text-xs text-muted-foreground cursor-pointer",children:"View Error Details"}),(0,s.jsx)("pre",{className:"mt-2 p-3 bg-muted rounded text-xs overflow-auto max-h-32",children:"string"==typeof k?k:JSON.stringify(k,null,2)})]})]}):L?(0,s.jsxs)("div",{className:"space-y-4",children:[(void 0!==L.balance||void 0!==L.availableBalance||void 0!==L.amount)&&(0,s.jsxs)("div",{className:"flex items-center justify-between p-4 bg-muted rounded-lg",children:[(0,s.jsx)("span",{className:"text-lg font-medium",children:"Available Balance:"}),(0,s.jsx)("span",{className:"text-2xl font-bold text-primary",children:(()=>{let e=L.balance??L.availableBalance??L.amount??0,s=L.currency||"GHS";if("number"==typeof e){let a=e>1e3?(e/100).toFixed(2):e.toFixed(2);return`${s} ${a}`}return`${s} ${e||"0.00"}`})()})]}),L.currency&&(0,s.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Currency: ",L.currency]}),L.accountName&&(0,s.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Account: ",L.accountName]}),L.accountNumber&&(0,s.jsxs)("div",{className:"text-sm text-muted-foreground font-mono",children:["Account Number: ",L.accountNumber]}),(0,s.jsxs)("details",{className:"mt-4",children:[(0,s.jsx)("summary",{className:"text-sm text-muted-foreground cursor-pointer",children:"View Raw Response"}),(0,s.jsx)("pre",{className:"mt-2 p-3 bg-muted rounded text-xs overflow-auto max-h-64",children:JSON.stringify(L,null,2)})]})]}):(0,s.jsx)("div",{className:"text-center py-8 border rounded-lg",children:(0,s.jsx)("p",{className:"text-muted-foreground",children:"Unable to load balance. Please check configuration."})})})]}),(0,s.jsxs)(t.Card,{children:[(0,s.jsx)(t.CardHeader,{children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(t.CardTitle,{children:"SMS Status"}),(0,s.jsx)(t.CardDescription,{children:"View and check the status of sent SMS messages."})]}),(0,s.jsxs)(l.Button,{onClick:z,variant:"outline",size:"sm",disabled:b,children:[(0,s.jsx)(c.RefreshCw,{className:`h-4 w-4 mr-2 ${b?"animate-spin":""}`}),"Refresh"]})]})}),(0,s.jsx)(t.CardContent,{className:"space-y-4",children:b?(0,s.jsxs)("div",{className:"text-center py-8",children:[(0,s.jsx)(i.Loader2,{className:"h-6 w-6 animate-spin mx-auto mb-2"}),(0,s.jsx)("p",{className:"text-muted-foreground",children:"Loading sent SMS messages..."})]}):0===v.length?(0,s.jsx)("div",{className:"text-center py-8 border rounded-lg",children:(0,s.jsx)("p",{className:"text-muted-foreground",children:"No SMS messages sent yet."})}):(0,s.jsx)("div",{className:"border rounded-lg",children:(0,s.jsxs)(f.Table,{children:[(0,s.jsx)(f.TableHeader,{children:(0,s.jsxs)(f.TableRow,{children:[(0,s.jsx)(f.TableHead,{children:"Type"}),(0,s.jsx)(f.TableHead,{children:"Recipient"}),(0,s.jsx)(f.TableHead,{children:"Patient"}),(0,s.jsx)(f.TableHead,{children:"Message"}),(0,s.jsx)(f.TableHead,{children:"Sent At"}),(0,s.jsx)(f.TableHead,{children:"Status"}),(0,s.jsx)(f.TableHead,{children:"Message ID"}),(0,s.jsx)(f.TableHead,{className:"text-right",children:"Action"})]})}),(0,s.jsx)(f.TableBody,{children:v.map(a=>{var t;return(0,s.jsxs)(f.TableRow,{children:[(0,s.jsx)(f.TableCell,{children:(0,s.jsx)(p.Badge,{variant:(t=a.type)&&({bulk:"default",birthday:"secondary",followup:"outline"})[t]||"outline",className:"capitalize",children:a.type})}),(0,s.jsx)(f.TableCell,{className:"font-mono text-xs",children:a.recipient}),(0,s.jsx)(f.TableCell,{children:a.patient?.name||"-"}),(0,s.jsx)(f.TableCell,{className:"max-w-[200px]",children:(0,s.jsx)("p",{className:"truncate text-sm",children:a.content})}),(0,s.jsx)(f.TableCell,{children:(0,g.format)(new Date(a.sentAt),"MMM d, yyyy 'at' h:mm a")}),(0,s.jsx)(f.TableCell,{children:(0,s.jsx)(p.Badge,{variant:_(a.status),children:a.status})}),(0,s.jsx)(f.TableCell,{className:"font-mono text-xs",children:a.batchId||a.messageId||"-"}),(0,s.jsx)(f.TableCell,{className:"text-right",children:(0,s.jsx)(l.Button,{size:"sm",variant:"outline",onClick:()=>$(a),disabled:e&&F===a.id,children:e&&F===a.id?(0,s.jsx)(i.Loader2,{className:"h-4 w-4 animate-spin"}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(d.Search,{className:"h-4 w-4 mr-2"}),"Check"]})})})]},a.id)})})]})})})]}),(0,s.jsxs)(t.Card,{children:[(0,s.jsxs)(t.CardHeader,{children:[(0,s.jsx)(t.CardTitle,{children:"Manual Status Check"}),(0,s.jsx)(t.CardDescription,{children:"Check status by entering a Message ID or Batch ID directly."})]}),(0,s.jsxs)(t.CardContent,{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(r.Label,{htmlFor:"message-id",children:"Message ID / Batch ID"}),(0,s.jsx)(n.Input,{id:"message-id",value:T,onChange:e=>C(e.target.value),placeholder:"Enter message ID or batch ID"})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(j.Checkbox,{id:"is-batch",checked:M,onCheckedChange:e=>I(!0===e)}),(0,s.jsx)(r.Label,{htmlFor:"is-batch",className:"cursor-pointer",children:"This is a Batch ID"})]}),(0,s.jsx)(l.Button,{onClick:()=>$(),disabled:e||!T.trim(),className:"w-full",children:e?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(i.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Checking Status..."]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(d.Search,{className:"mr-2 h-4 w-4"}),"Check Status"]})})]}),H&&(0,s.jsx)("div",{className:"space-y-4 mt-6",children:(0,s.jsxs)("div",{className:"border rounded-lg p-4 space-y-3",children:[(0,s.jsx)("h3",{className:"font-semibold text-lg",children:"Status Information"}),H.status&&(0,s.jsx)("div",{className:"space-y-2",children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"text-sm font-medium",children:"Status:"}),(0,s.jsx)(p.Badge,{variant:_(H.status),children:H.status||"-"})]})}),H.batchId&&(0,s.jsx)("div",{className:"space-y-2",children:(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-sm font-medium",children:"Batch ID:"}),(0,s.jsx)("span",{className:"ml-2 text-sm font-mono",children:H.batchId})]})}),H.messageId&&(0,s.jsx)("div",{className:"space-y-2",children:(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-sm font-medium",children:"Message ID:"}),(0,s.jsx)("span",{className:"ml-2 text-sm font-mono",children:H.messageId})]})}),H.recipient&&(0,s.jsx)("div",{className:"space-y-2",children:(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-sm font-medium",children:"Recipient:"}),(0,s.jsx)("span",{className:"ml-2 text-sm font-mono",children:H.recipient})]})}),H.from&&(0,s.jsx)("div",{className:"space-y-2",children:(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-sm font-medium",children:"From:"}),(0,s.jsx)("span",{className:"ml-2 text-sm",children:H.from})]})}),H.content&&(0,s.jsx)("div",{className:"space-y-2",children:(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-sm font-medium",children:"Message:"}),(0,s.jsx)("p",{className:"mt-1 text-sm text-muted-foreground",children:H.content})]})}),H.createdAt&&(0,s.jsx)("div",{className:"space-y-2",children:(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-sm font-medium",children:"Created At:"}),(0,s.jsx)("span",{className:"ml-2 text-sm",children:new Date(H.createdAt).toLocaleString()})]})}),H.sentAt&&(0,s.jsx)("div",{className:"space-y-2",children:(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-sm font-medium",children:"Sent At:"}),(0,s.jsx)("span",{className:"ml-2 text-sm",children:new Date(H.sentAt).toLocaleString()})]})}),H.deliveredAt&&(0,s.jsx)("div",{className:"space-y-2",children:(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-sm font-medium",children:"Delivered At:"}),(0,s.jsx)("span",{className:"ml-2 text-sm",children:new Date(H.deliveredAt).toLocaleString()})]})}),H.messages&&Array.isArray(H.messages)&&H.messages.length>0&&(0,s.jsxs)("div",{className:"space-y-2 mt-4",children:[(0,s.jsx)("span",{className:"text-sm font-medium",children:"Batch Messages:"}),(0,s.jsx)("div",{className:"border rounded-lg mt-2",children:(0,s.jsxs)(f.Table,{children:[(0,s.jsx)(f.TableHeader,{children:(0,s.jsxs)(f.TableRow,{children:[(0,s.jsx)(f.TableHead,{children:"Recipient"}),(0,s.jsx)(f.TableHead,{children:"Status"}),(0,s.jsx)(f.TableHead,{children:"Message ID"}),(0,s.jsx)(f.TableHead,{children:"Sent At"})]})}),(0,s.jsx)(f.TableBody,{children:H.messages.map((e,a)=>(0,s.jsxs)(f.TableRow,{children:[(0,s.jsx)(f.TableCell,{className:"font-mono text-xs",children:e.recipient||e.To||"-"}),(0,s.jsx)(f.TableCell,{children:(0,s.jsx)(p.Badge,{variant:_(e.status),children:e.status||"-"})}),(0,s.jsx)(f.TableCell,{className:"font-mono text-xs",children:e.messageId||"-"}),(0,s.jsx)(f.TableCell,{children:e.sentAt?new Date(e.sentAt).toLocaleString():"-"})]},a))})]})})]}),(0,s.jsxs)("details",{className:"mt-4",children:[(0,s.jsx)("summary",{className:"text-sm text-muted-foreground cursor-pointer",children:"View Raw Response"}),(0,s.jsx)("pre",{className:"mt-2 p-3 bg-muted rounded text-xs overflow-auto max-h-64",children:JSON.stringify(H,null,2)})]})]})})]})]})]})}e.s(["SMSStatusTab",()=>b],110649)},801300,e=>{"use strict";var s=e.i(843476),a=e.i(271645),t=e.i(947627),l=e.i(167881),n=e.i(531278),r=e.i(16715),i=e.i(95187);let d=(0,i.createServerReference)("00dc676da96576d3b8b1dfb987983a0d8bb4e50632",i.callServer,void 0,i.findSourceMapURL,"getFailedSMSMessages"),c=(0,i.createServerReference)("40ac0ee81c0a082274d2f89e3368e071ad10649642",i.callServer,void 0,i.findSourceMapURL,"retrySMS");var o=e.i(846696),m=e.i(401851);function h(){let[e,i]=(0,a.useState)([]),[h,x]=(0,a.useState)(!0),[u,p]=(0,a.useState)(new Set),j=async()=>{x(!0);let e=await d();e.success&&e.data?i(e.data):o.toast.error(e.error||"Failed to load messages"),x(!1)};(0,a.useEffect)(()=>{j()},[]);let g=async e=>{p(s=>new Set(s).add(e));try{let s=await c(e);s.success?(o.toast.success("SMS retried successfully"),j()):o.toast.error(s.error||"Failed to retry SMS")}catch{o.toast.error("An error occurred during retry")}finally{p(s=>{let a=new Set(s);return a.delete(e),a})}};return h?(0,s.jsx)("div",{className:"flex h-[200px] items-center justify-center",children:(0,s.jsx)(n.Loader2,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)("h2",{className:"text-lg font-semibold",children:"Failed Messages"}),(0,s.jsxs)(l.Button,{variant:"outline",size:"sm",onClick:j,children:[(0,s.jsx)(r.RefreshCw,{className:"mr-2 h-4 w-4"}),"Refresh"]})]}),(0,s.jsx)("div",{className:"rounded-md border",children:(0,s.jsxs)(t.Table,{children:[(0,s.jsx)(t.TableHeader,{children:(0,s.jsxs)(t.TableRow,{children:[(0,s.jsx)(t.TableHead,{children:"Date"}),(0,s.jsx)(t.TableHead,{children:"Recipient"}),(0,s.jsx)(t.TableHead,{className:"w-[40%]",children:"Message"}),(0,s.jsx)(t.TableHead,{className:"text-right",children:"Action"})]})}),(0,s.jsx)(t.TableBody,{children:0===e.length?(0,s.jsx)(t.TableRow,{children:(0,s.jsx)(t.TableCell,{colSpan:4,className:"h-24 text-center",children:"No failed messages found."})}):e.map(e=>(0,s.jsxs)(t.TableRow,{children:[(0,s.jsx)(t.TableCell,{children:(0,m.format)(new Date(e.createdAt),"MMM d, yyyy HH:mm")}),(0,s.jsx)(t.TableCell,{children:(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("span",{className:"font-medium",children:e.patient?.name||"Unknown Patient"}),(0,s.jsx)("span",{className:"text-xs text-muted-foreground",children:e.recipient})]})}),(0,s.jsx)(t.TableCell,{className:"break-words",children:e.content}),(0,s.jsx)(t.TableCell,{className:"text-right",children:(0,s.jsxs)(l.Button,{size:"sm",onClick:()=>g(e.id),disabled:u.has(e.id),children:[u.has(e.id)?(0,s.jsx)(n.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}):(0,s.jsx)(r.RefreshCw,{className:"mr-2 h-4 w-4"}),"Retry"]})})]},e.id))})]})})]})}e.s(["FailedSMSTab",()=>h],801300)}]);